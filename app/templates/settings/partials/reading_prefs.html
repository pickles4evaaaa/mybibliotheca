{% with msgs = get_flashed_messages(with_categories=True) %}
  {% if msgs %}
    <div class="mb-2">
      {% for c,m in msgs %}<div class="alert alert-{{ 'danger' if c=='error' else c }} py-1 mb-1 small">{{ m }}</div>{% endfor %}
    </div>
  {% endif %}
{% endwith %}

<form method="POST" action="{{ url_for('auth.settings_reading_prefs_partial') }}" hx-post="{{ url_for('auth.settings_reading_prefs_partial') }}" hx-target="#personalDynamicContainer" hx-swap="innerHTML" class="mb-4">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
  <div class="row g-3">
    <div class="col-md-4">
      <label class="form-label">Library Rows per Page</label>
      <input type="number" min="1" step="1" name="library_rows_per_page" class="form-control" value="{{ settings.library_rows_per_page or '' }}" placeholder="e.g. 4"/>
      <small class="text-muted">Leave blank to use server default.</small>
    </div>
    <div class="col-md-4">
      <label class="form-label">Default Pages per Log</label>
      <input type="number" min="0" step="1" name="default_pages_per_log" class="form-control" value="{{ settings.default_pages_per_log or '' }}" placeholder="e.g. 10"/>
      <small class="text-muted">Leave blank to use server default (if any)</small>
    </div>
    <div class="col-md-4">
      <label class="form-label">Default Minutes per Log</label>
      <input type="number" min="0" step="1" name="default_minutes_per_log" class="form-control" value="{{ settings.default_minutes_per_log or '' }}" placeholder="e.g. 20"/>
      <small class="text-muted">Leave blank to use server default (if any)</small>
    </div>
  </div>
  <div class="row g-3 mt-1">
    <div class="col-md-4">
      <label class="form-label">Default Library Status Filter</label>
      <select name="library_default_status" class="form-select">
        {% set current_status = settings.library_default_status or 'all' %}
        {% for value, label in library_status_choices %}
          <option value="{{ value }}" {% if current_status == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
      <small class="text-muted">Applied when you open the library. Choose "All Books" to disable.</small>
    </div>
    <div class="col-md-4">
      <label class="form-label">Default Library Sort Order</label>
      <select name="library_default_sort" class="form-select">
        {% set current_sort = settings.library_default_sort or 'title_asc' %}
        {% for value, label in library_sort_choices %}
          <option value="{{ value }}" {% if current_sort == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
      <small class="text-muted">Controls how books are ordered on first load.</small>
    </div>
    <div class="col-md-4">
      <label class="form-label">Default Reading Status for New Books</label>
      <select name="default_reading_status" class="form-select">
        {% set current_reading_status = settings.default_reading_status or '' %}
        {% for value, label in default_reading_status_choices %}
          <option value="{{ value }}" {% if current_reading_status == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
      <small class="text-muted">Automatically applied when adding new books. Can be changed per book.</small>
    </div>
  </div>
  <div class="mt-3">
    <button class="btn btn-primary"><i class="bi bi-save"></i> Save Library Preferences</button>
  </div>
</form>


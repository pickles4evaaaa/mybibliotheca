<!-- Macros for displaying book categories -->

{% macro display_categories(book, compact=false, show_icon=true, style_class="", max_display=5, book_categories=None) %}
  {% set categories = book_categories if book_categories else (book.categories if book.categories else []) %}
  {% set book_id = book.uid if book.uid else (book.id if book.id else 'book') %}
  
  {% if categories %}
    {% if compact %}
      <!-- Compact display for library cards -->
      <div class="category-tags d-inline-flex flex-wrap gap-1">
        {% for category in categories[:max_display] %}
          <span class="category-tag-compact" 
                {% if category.color %}style="background-color: {{ category.color }}20; border-color: {{ category.color }}80; color: {{ category.color }}"{% endif %}>
            {% if show_icon %}<i class="bi bi-tag-fill me-1"></i>{% endif %}
            <a href="{{ url_for('genres.category_details', category_id=category.id) }}" class="text-decoration-none" 
               {% if category.color %}style="color: {{ category.color }}"{% endif %}>
              <span class="{{ style_class if not category.color else '' }}">{{ category.name }}</span>
            </a>
          </span>
        {% endfor %}
        {% if categories|length > max_display %}
          <small class="text-muted"> +{{ categories|length - max_display }} more</small>
        {% endif %}
      </div>
    {% else %}
      <!-- Full display for book details -->
      <div class="category-tags d-inline-flex flex-wrap gap-1 align-items-center">
        {% for category in categories[:3] %}
          <span class="category-tag-display" 
                {% if category.color %}style="background-color: {{ category.color }}20; border-color: {{ category.color }}; color: {{ category.color }}"{% endif %}>
            <a href="{{ url_for('genres.category_details', category_id=category.id) }}" 
               class="text-decoration-none d-flex align-items-center"
               {% if category.color %}style="color: {{ category.color }}"{% endif %}>
              {% if show_icon %}
                {% if category.icon %}
                  <span class="me-1">{{ category.icon }}</span>
                {% else %}
                  <i class="bi bi-tag-fill me-1"></i>
                {% endif %}
              {% endif %}
              {{ category.name }}
            </a>
          </span>
        {% endfor %}
        {% if categories|length > 3 %}
          <div class="dropdown d-inline-block">
            <button class="btn btn-sm btn-outline-secondary dropdown-toggle genre-more-btn" type="button" id="moreGenresDropdown-{{ book_id }}" data-bs-toggle="dropdown" aria-expanded="false">
              +{{ categories|length - 3 }} more
            </button>
            <ul class="dropdown-menu genre-dropdown-menu" aria-labelledby="moreGenresDropdown-{{ book_id }}">
              {% for category in categories[3:] %}
                <li>
                  <a class="dropdown-item d-flex align-items-center" href="{{ url_for('genres.category_details', category_id=category.id) }}">
                    {% if category.icon %}
                      <span class="me-2">{{ category.icon }}</span>
                    {% else %}
                      <i class="bi bi-tag-fill me-2"></i>
                    {% endif %}
                    {{ category.name }}
                  </a>
                </li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      </div>
    {% endif %}
  {% endif %}
{% endmacro %}

{% macro display_category_badges(book, show_icon=true) %}
  {% set categories = book_categories if book_categories is defined else book.categories %}
  
  {% if categories %}
    <div class="d-flex flex-wrap gap-1">
      {% for category in categories %}
        <a href="{{ url_for('genres.category_details', category_id=category.id) }}" class="text-decoration-none">
          <span class="badge" 
                {% if category.color %}style="background-color: {{ category.color }}; border-color: {{ category.color }}"{% else %}style="background-color: #6c757d"{% endif %}>
            {% if show_icon %}
              {% if category.icon %}
                <span class="me-1">{{ category.icon }}</span>
              {% else %}
                <i class="bi bi-tag-fill me-1"></i>
              {% endif %}
            {% endif %}
            {{ category.name }}
          </span>
        </a>
      {% endfor %}
    </div>
  {% endif %}
{% endmacro %}

{% macro display_categories_for_library(book, max_display=3) %}
  {% set categories = book.categories if book.categories else [] %}
  
  {% if categories %}
    <div class="category-tags d-inline-flex flex-wrap gap-1">
      {% for category in categories[:max_display] %}
        <span class="category-tag-compact"
              {% if category.color %}style="background-color: {{ category.color }}20; border-color: {{ category.color }}80; color: {{ category.color }}"{% endif %}>
          <a href="{{ url_for('genres.category_details', category_id=category.id) }}" class="text-decoration-none"
             {% if category.color %}style="color: {{ category.color }}"{% endif %}>
            {% if category.icon %}<span class="me-1">{{ category.icon }}</span>{% endif %}
            <small>{{ category.name }}</small>
          </a>
        </span>
      {% endfor %}
      {% if categories|length > max_display %}
        <small class="text-muted"> +{{ categories|length - max_display }} more</small>
      {% endif %}
    </div>
  {% endif %}
{% endmacro %}

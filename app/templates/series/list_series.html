{% extends 'base.html' %}
{% block title %}Series - MyBibliotheca{% endblock %}
{% block content %}
<div class="container mt-4">
  <h1 class="mb-3">Series</h1>
  {% if request.args.get('debug') %}
  <div class="card mb-3 border-danger">
    <div class="card-body p-2">
      <div class="small fw-semibold mb-1">Series Debug ({{ series_list|length }} total)</div>
      <pre class="small mb-0" style="max-height:260px; overflow:auto;">
{% for s in series_list %}{% if loop.index <= 15 %}{{ loop.index }}. id={{ s.id }}
    name={{ s.name }}
  cover={{ s.cover_url or 'None' }}
    custom={{ s.custom_cover }} generated_placeholder={{ s.generated_placeholder }} book_count={{ s.book_count if s.book_count is defined else 'n/a' }}

{% endif %}{% endfor %}
      </pre>
      <div class="text-muted small mt-1">Debug: first 15 series. Append <code>?debug=1</code> to toggle.</div>
    </div>
  </div>
  {% endif %}
  <style>
    /* Unified cover styling to match library page (contain, no cropping, 2:3 space) */
    .series-cover-wrapper { position:relative; height:240px; padding:0.5rem; background:#f8f9fa; overflow:hidden; display:flex; align-items:center; justify-content:center; }
    .series-cover-wrapper::before { content:""; display:block; position:absolute; inset:0; padding-top:150%; pointer-events:none; }
    .series-cover-wrapper img, .series-cover-wrapper span { position:absolute; inset:0; margin:auto; max-width:100%; max-height:100%; object-fit:contain; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
    [data-theme="dark"] .series-cover-wrapper { background:#2d2d2d; }
  </style>
  <div class="row">
    {% for s in series_list %}
      <div class="col-6 col-sm-4 col-md-3 col-lg-2 mb-4">
        <div class="card h-100 shadow-sm border-0">
          <a href="{{ url_for('series.series_detail', series_id=s.id) }}" class="text-decoration-none">
            <div class="series-cover-wrapper">
              {% set effective_cover = s.user_cover or s.cover_url %}
              {% if effective_cover %}<img src="{{ effective_cover }}" alt="{{ s.name }} cover">{% else %}<span class="text-muted small text-center px-2">{{ s.name }}</span>{% endif %}
            </div>
            <div class="card-body p-2">
              <div class="series-name text-truncate" title="{{ s.name }}">{{ s.name }}</div>
              {% set bc = s.book_count if s.book_count is defined else 0 %}
              <div class="text-muted small">{{ bc }} book{{ '' if bc == 1 else 's' }}</div>
            </div>
          </a>
        </div>
      </div>
    {% else %}
      <p class="text-muted">No series found.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}
